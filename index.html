<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Connect & Celebrate - AI Event System</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<style>
* { font-family: 'Poppins', sans-serif; }
body { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); }
.card-hover { transition: all 0.3s ease; cursor: grab; }
.card-hover:active { cursor: grabbing; }
.card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
.animate-float { animation: float 3s ease-in-out infinite; }
</style>
</head>
<body>

<div id="app"></div>

<script>
let state = {
    activeTab: 'create',
    events: [],
    tasks: [],
    contacts: [],
    voices: [],
    currentEvent: { title:'', date:'', time:'', location:'', description:'', host:'', template:'modern', rsvpDeadline:'' },
    currentTask: '',
    currentContact: { name:'', email:'', message:'' },
    currentVoice: { command:'', response:'' },
    isRecording: false,
};

// Templates
const templates = {
    modern: { bg: 'bg-gradient-to-br from-blue-50 to-indigo-100', accent: 'text-blue-600', border: 'border-blue-300' },
    elegant: { bg: 'bg-gradient-to-br from-purple-50 to-pink-100', accent: 'text-purple-600', border: 'border-purple-300' },
    casual: { bg: 'bg-gradient-to-br from-green-50 to-emerald-100', accent: 'text-green-600', border: 'border-green-300' }
};

// --- RENDER ---
function render() {
    document.getElementById('app').innerHTML = `
    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white shadow-xl">
        <div class="max-w-6xl mx-auto px-4 py-6">
            <h1 class="text-3xl font-bold flex items-center gap-3">
                <i data-lucide="calendar" class="h-8 w-8"></i>
                Connect & Celebrate
            </h1>
            <p class="text-indigo-100 mt-1">AI Event & Task Manager</p>
        </div>
    </div>

    <div class="max-w-6xl mx-auto px-4 py-6">
        <div class="flex gap-2 bg-white rounded-xl p-2 shadow-lg">
            ${['create','manage','contacts','voice'].map(tab => `
                <button onclick="changeTab('${tab}')" class="flex-1 py-3 rounded-lg font-semibold transition ${state.activeTab===tab?'bg-gradient-to-r from-indigo-600 to-purple-600 text-white':'text-gray-600 hover:bg-gray-100'}">
                    ${tab.charAt(0).toUpperCase()+tab.slice(1)}
                </button>
            `).join('')}
        </div>
    </div>

    <div class="max-w-6xl mx-auto px-4 pb-8">
        ${getContent()}
    </div>
    `;
    if(window.lucide) lucide.createIcons();
}

// --- TAB CONTENT ---
function getContent() {
    if(state.activeTab==='create') return `
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                <h2 class="text-xl font-bold mb-4">Create Event</h2>
                <div class="space-y-4">
                    <input type="text" placeholder="Event Title" value="${state.currentEvent.title}" oninput="state.currentEvent.title=this.value" class="w-full px-4 py-3 border rounded-lg">
                    <div class="grid grid-cols-2 gap-4">
                        <input type="date" value="${state.currentEvent.date}" oninput="state.currentEvent.date=this.value" class="w-full px-4 py-3 border rounded-lg">
                        <input type="time" value="${state.currentEvent.time}" oninput="state.currentEvent.time=this.value" class="w-full px-4 py-3 border rounded-lg">
                    </div>
                    <input type="text" placeholder="Location" value="${state.currentEvent.location}" oninput="state.currentEvent.location=this.value" class="w-full px-4 py-3 border rounded-lg">
                    <input type="text" placeholder="Host" value="${state.currentEvent.host}" oninput="state.currentEvent.host=this.value" class="w-full px-4 py-3 border rounded-lg">
                    <textarea placeholder="Description" oninput="state.currentEvent.description=this.value" class="w-full px-4 py-3 border rounded-lg" rows="3">${state.currentEvent.description}</textarea>
                    <input type="date" placeholder="RSVP Deadline" value="${state.currentEvent.rsvpDeadline}" oninput="state.currentEvent.rsvpDeadline=this.value" class="w-full px-4 py-3 border rounded-lg">
                    
                    <h3 class="font-semibold">Select Template:</h3>
                    <div class="grid grid-cols-3 gap-2">
                        ${Object.keys(templates).map(key=>`
                            <div class="card-hover p-3 rounded-lg ${templates[key].bg} ${state.currentEvent.template===key?'ring-4 ring-offset-2 '+templates[key].border:''}" draggable="true" ondragstart="dragStart(event,'${key}')" onclick="state.currentEvent.template='${key}'">
                                <div class="${templates[key].accent} font-semibold capitalize text-center">${key}</div>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="createEvent()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-3 rounded-lg font-bold hover:shadow-xl transition">
                        Create Event
                    </button>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
                <h2 class="text-xl font-bold mb-4">Preview</h2>
                <div id="preview" class="p-6 rounded-xl border-2 ${templates[state.currentEvent.template].bg} ${templates[state.currentEvent.template].border}">
                    <h3 class="text-2xl font-bold text-center mb-4">${state.currentEvent.title||'Event Title'}</h3>
                    <div class="space-y-2 text-center">
                        <p>üìÖ ${state.currentEvent.date||'Date'} at ${state.currentEvent.time||'Time'}</p>
                        <p>üìç ${state.currentEvent.location||'Location'}</p>
                        ${state.currentEvent.host?`<p>üë§ Hosted by: ${state.currentEvent.host}</p>`:''}
                        ${state.currentEvent.description?`<p class="mt-4 italic">${state.currentEvent.description}</p>`:''}
                        ${state.currentEvent.rsvpDeadline?`<p class="mt-2 text-sm text-gray-500">RSVP by ${state.currentEvent.rsvpDeadline}</p>`:''}
                    </div>
                </div>
            </div>
        </div>
    `;

    if(state.activeTab==='manage') return `
        <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
            <h2 class="text-xl font-bold mb-4">Manage Tasks</h2>
            <div class="flex gap-2 mb-4">
                <input type="text" placeholder="New Task" class="flex-1 px-4 py-2 border rounded-lg" oninput="state.currentTask=this.value">
                <button onclick="addTask()" class="px-4 py-2 bg-indigo-600 text-white rounded-lg">Add</button>
            </div>
            <ul class="space-y-2">
                ${state.tasks.map(t=>`
                    <li class="flex justify-between items-center p-2 border rounded-lg">
                        <span>${t.task} (${t.status})</span>
                        <div class="flex gap-2">
                            <button onclick="updateTask(${t.id})" class="px-2 py-1 bg-green-500 text-white rounded">‚úì</button>
                            <button onclick="deleteTask(${t.id})" class="px-2 py-1 bg-red-500 text-white rounded">‚úï</button>
                        </div>
                    </li>
                `).join('')}
            </ul>
        </div>
    `;

    if(state.activeTab==='contacts') return `
        <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
            <h2 class="text-xl font-bold mb-4">Contacts</h2>
            <div class="space-y-2 mb-4">
                <input type="text" placeholder="Name" class="w-full px-4 py-2 border rounded" oninput="state.currentContact.name=this.value">
                <input type="email" placeholder="Email" class="w-full px-4 py-2 border rounded" oninput="state.currentContact.email=this.value">
                <textarea placeholder="Message" class="w-full px-4 py-2 border rounded" rows="3" oninput="state.currentContact.message=this.value"></textarea>
                <button onclick="addContact()" class="w-full py-2 bg-indigo-600 text-white rounded">Send</button>
            </div>
            <ul class="space-y-2">
                ${state.contacts.map(c=>`<li class="p-2 border rounded"><strong>${c.name}</strong> (${c.email}): ${c.message}</li>`).join('')}
            </ul>
        </div>
    `;

    if(state.activeTab==='voice') return `
        <div class="bg-white rounded-xl shadow-lg p-6 card-hover">
            <h2 class="text-xl font-bold mb-4">Voice Commands</h2>
            <div class="flex gap-2 mb-4">
                <input type="text" placeholder="Command" class="flex-1 px-4 py-2 border rounded" oninput="state.currentVoice.command=this.value">
                <input type="text" placeholder="Response" class="flex-1 px-4 py-2 border rounded" oninput="state.currentVoice.response=this.value">
                <button onclick="recordVoice()" class="px-4 py-2 bg-indigo-600 text-white rounded">${state.isRecording?'Recording...':'Record & Save'}</button>
            </div>
            <ul class="space-y-2">
                ${state.voices.map(v=>`<li class="p-2 border rounded"><strong>${v.command}</strong>: ${v.response}</li>`).join('')}
            </ul>
        </div>
    `;
}

// --- TAB SWITCH ---
function changeTab(tab){
    state.activeTab=tab;
    if(tab==='manage') loadTasks();
    if(tab==='contacts') loadContacts();
    if(tab==='voice') loadVoices();
    if(tab==='create') loadEvents();
    render();
}

// --- DRAG ---
function dragStart(e,key){ state.currentEvent.template=key; render(); }

// --- EVENTS API ---
async function loadEvents(){
    const res = await fetch('http://127.0.0.1:5000/api/events');
    state.events = await res.json();
    render();
}
async function createEvent(){
    if(!state.currentEvent.title||!state.currentEvent.date||!state.currentEvent.time){ alert('Fill Title, Date & Time'); return; }
    const res = await fetch('http://127.0.0.1:5000/api/events',{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(state.currentEvent)});
    const data = await res.json();
    alert('Event Created!');
    state.currentEvent={ title:'', date:'', time:'', location:'', description:'', host:'', template:'modern', rsvpDeadline:'' };
    loadEvents();
}

// --- TASKS API ---
async function loadTasks(){
    const res = await fetch('http://127.0.0.1:5000/api/manage');
    state.tasks = await res.json();
    render();
}
async function addTask(){
    if(!state.currentTask) return;
    await fetch('http://127.0.0.1:5000/api/manage',{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({task:state.currentTask})});
    state.currentTask='';
    loadTasks();
}
async function updateTask(id){
    await fetch(`http://127.0.0.1:5000/api/manage/${id}`,{ method:'PUT', headers:{'Content-Type':'application/json'}, body:JSON.stringify({status:'completed'})});
    loadTasks();
}
async function deleteTask(id){
    await fetch(`http://127.0.0.1:5000/api/manage/${id}`,{ method:'DELETE'});
    loadTasks();
}

// --- CONTACTS API ---
async function loadContacts(){
    const res = await fetch('http://127.0.0.1:5000/api/contacts');
    state.contacts = await res.json();
    render();
}
async function addContact(){
    if(!state.currentContact.name||!state.currentContact.email||!state.currentContact.message) return;
    await fetch('http://127.0.0.1:5000/api/contacts',{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(state.currentContact)});
    state.currentContact={name:'', email:'', message:''};
    loadContacts();
}

// --- VOICE API ---
async function loadVoices(){
    const res = await fetch('http://127.0.0.1:5000/api/voice');
    state.voices = await res.json();
    render();
}
function recordVoice(){
    if(!state.currentVoice.command||!state.currentVoice.response){ alert('Fill Command & Response'); return; }
    state.isRecording=true; render();
    setTimeout(async()=>{
        state.isRecording=false;
        await fetch('http://127.0.0.1:5000/api/voice',{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(state.currentVoice)});
        state.currentVoice={command:'', response:''};
        loadVoices();
        alert('Voice command saved!');
    },2000);
}

// --- INIT ---
changeTab('create');
render();
</script>
</body>
</html>
